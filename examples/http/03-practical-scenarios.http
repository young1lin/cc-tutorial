# ============================================
# 实用场景示例
# ============================================
# 说明：展示 LLM 在实际工作中的应用场景
# 模型：GLM-4.7
# 场景：代码审查、摘要、情感分析、翻译、数据提取、内容生成
# ============================================

# 环境变量
@GLM_BASE_URL = https://open.bigmodel.cn/api/coding/paas/v4/chat/completions
@GLM_BEARER_TOKEN = Bearer {{$dotenv GLM_API_KEY}}

# ============================================
# 1. 代码审查与测试
# ============================================

### [场景 1.1] 代码审查 - 发现 Bug
# 场景：Python 代码审查，识别除零错误、KeyError 等
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个资深的代码审查专家。请仔细审查以下代码，找出所有潜在问题，包括：\n1. Bug 和逻辑错误\n2. 性能问题\n3. 安全漏洞\n4. 代码风格问题\n\n对每个问题，请说明：位置、问题描述、严重程度、修复建议。"
    },
    {
      "role": "user",
      "content": "请审查以下 Python 代码：\n\n```python\ndef calculate_average(numbers):\n    total = 0\n    for num in numbers:\n        total += num\n    return total / len(numbers)\n\ndef process_data(data):\n    result = []\n    for item in data:\n        if item['value'] > 0:\n            result.append(item['value'] * 2)\n    return result\n\nusers = [{'name': 'Alice', 'age': 30}, {'name': 'Bob'}]\nfor user in users:\n    print(f\"{user['name']} is {user['age']} years old\")\n```"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

### [场景 1.2] 单元测试生成
# 场景：为给定函数生成 pytest 测试（正常/边界/异常）
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个测试工程师。请为给定的函数编写完整的单元测试，包括：\n1. 正常情况测试\n2. 边界情况测试\n3. 异常情况测试\n4. 使用 pytest 框架"
    },
    {
      "role": "user",
      "content": "请为以下 Python 函数生成单元测试：\n\n```python\ndef calculate_discount(price: float, discount_rate: float) -> float:\n    \"\"\"\n    计算折扣后的价格\n    \n    Args:\n        price: 原价（必须 > 0）\n        discount_rate: 折扣率（0-1 之间）\n    \n    Returns:\n        折扣后的价格\n    \"\"\"\n    if price <= 0:\n        raise ValueError(\"Price must be positive\")\n    if not 0 <= discount_rate <= 1:\n        raise ValueError(\"Discount rate must be between 0 and 1\")\n    return price * (1 - discount_rate)\n```"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

# ============================================
# 2. 文本摘要
# ============================================

### [场景 2.1] 新闻摘要 - 提取要点
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个新闻编辑。请将新闻内容总结为 3-5 条关键要点，每条不超过 30 字。"
    },
    {
      "role": "user",
      "content": "请总结以下新闻：\n\n杭州市政府今天宣布，将在未来三年内投资 50 亿元打造智慧城市项目。该项目包括建设城市大脑、智能交通系统和数字政务平台。市长表示，这将大幅提升城市管理效率，改善市民生活质量。项目预计将创造 2000 个就业岗位，并吸引更多科技企业入驻。目前已有 10 家知名科技公司签约参与项目建设。专家认为，此举将使杭州成为全国智慧城市建设的标杆。"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

### [场景 2.2] 会议记录 - 行动项提取
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个会议助手。请从会议记录中提取所有行动项，格式：\n- [ ] 任务描述 | 负责人 | 截止日期"
    },
    {
      "role": "user",
      "content": "请从以下会议记录提取行动项：\n\n产品会议记录（2026-02-09）\n参会人员：张三（产品）、李四（开发）、王五（设计）\n\n讨论内容：\n1. 新版本功能规划\n   - 张三：下周一前完成需求文档\n   - 李四：评估技术可行性，周三前给出方案\n   - 王五：设计 UI 原型，下周五前完成\n\n2. Bug 修复\n   - 李四：今天下班前修复登录问题\n   - 张三：跟进用户反馈，本周内给出解决方案\n\n3. 测试计划\n   - 全员：下周二参加测试培训\n   - 李四：准备测试环境，下周一完成"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

# ============================================
# 3. 情感分析
# ============================================

### [场景 3.1] 细粒度情感分析 - 多维度 JSON 评分
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个情感分析专家。请对评论进行多维度分析，以 JSON 格式返回：\n```json\n{\n  \"overall\": \"正面/负面/中性\",\n  \"aspects\": {\n    \"质量\": {\"sentiment\": \"正面/负面/中性\", \"score\": 1-5},\n    \"服务\": {\"sentiment\": \"正面/负面/中性\", \"score\": 1-5},\n    \"价格\": {\"sentiment\": \"正面/负面/中性\", \"score\": 1-5}\n  },\n  \"summary\": \"一句话总结\"\n}\n```"
    },
    {
      "role": "user",
      "content": "这款手机性能强悍，拍照效果很棒，但电池续航一般，而且价格偏高。客服态度不错，物流也很快。"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

# ============================================
# 4. 文本翻译
# ============================================

### [场景 4.1] 专业术语翻译 - 技术文档
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个技术文档翻译专家。请准确翻译专业术语，必要时保留英文原文（加括号）。"
    },
    {
      "role": "user",
      "content": "请将以下技术文档翻译为英文：\n\nReAct 框架通过交替执行推理（Reasoning）和行动（Acting）来解决问题。它使用思维链（Chain-of-Thought）提示词引导大语言模型（LLM）输出推理过程，然后调用外部工具（Tools）执行行动。这种方法在 HotpotQA 基准测试中取得了最先进（SOTA）的结果。"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

# ============================================
# 5. 数据提取与结构化
# ============================================

### [场景 5.1] 实体提取 - 命名实体识别
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个实体提取助手。请从文本中提取所有实体，以 JSON 格式返回：\n```json\n{\n  \"persons\": [\"人名1\", \"人名2\"],\n  \"locations\": [\"地名1\", \"地名2\"],\n  \"organizations\": [\"机构1\", \"机构2\"],\n  \"dates\": [\"日期1\", \"日期2\"]\n}\n```"
    },
    {
      "role": "user",
      "content": "请从以下文本提取实体：\n\n2026 年 2 月 9 日，阿里巴巴集团 CEO 张勇在杭州总部宣布，公司将投资 10 亿美元在美国硅谷建立 AI 研究院。该研究院将与斯坦福大学合作，重点研究大语言模型技术。"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

### [场景 5.2] 简历解析 - 关键信息提取
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个简历解析助手。请从简历中提取关键信息，以 JSON 格式返回：\n```json\n{\n  \"name\": \"姓名\",\n  \"contact\": {\"phone\": \"电话\", \"email\": \"邮箱\"},\n  \"education\": [{\"degree\": \"学位\", \"major\": \"专业\", \"school\": \"学校\", \"year\": \"毕业年份\"}],\n  \"work_experience\": [{\"company\": \"公司\", \"position\": \"职位\", \"duration\": \"时长\"}],\n  \"skills\": [\"技能1\", \"技能2\"]\n}\n```"
    },
    {
      "role": "user",
      "content": "请解析以下简历：\n\n张三\n电话：13800138000\n邮箱：zhangsan@example.com\n\n教育背景：\n浙江大学，计算机科学与技术，本科，2018-2022\n\n工作经历：\n阿里巴巴，前端工程师，2022-2024（2年）\n腾讯，高级前端工程师，2024-至今\n\n技能：React、TypeScript、Node.js、Python"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0
}

# ============================================
# 6. 内容生成
# ============================================

### [场景 6.1] 邮件撰写 - 商务邮件
POST {{GLM_BASE_URL}} HTTP/1.1
Content-Type: application/json
Accept: application/json
Authorization: {{GLM_BEARER_TOKEN}}

{
  "messages": [
    {
      "role": "system",
      "content": "你是一个商务写作助手。请根据用户提供的要点，撰写正式的商务邮件，包括：称呼、正文、结尾。"
    },
    {
      "role": "user",
      "content": "请撰写一封邮件，要点如下：\n- 收件人：李总\n- 目的：邀请参加产品发布会\n- 时间：2026年2月15日下午3点\n- 地点：杭州国际会议中心\n- 内容：介绍公司最新 AI 产品"
    }
  ],
  "model": "GLM-4.7",
  "stream": false,
  "temperature": 0.3
}

# ============================================
# 总结
# ============================================
#
# 实用场景速查：
#
# 代码审查：temperature=0, 详细 system prompt 列明检查维度
# 文本摘要：temperature=0, max_tokens=300
# 情感分析：temperature=0, JSON 结构化输出
# 技术翻译：temperature=0, 保留专业术语原文
# 数据提取：temperature=0, 提供 JSON Schema
# 内容生成：temperature=0.3, 明确格式要求
#
# 通用建议：
# - 用 temperature=0 提高一致性
# - 用 JSON Schema 约束输出格式
# - 精简 system prompt，去除冗余
# ============================================
