# Skill: code-review

## æ¦‚è¿°

`code-review` æ˜¯ Claude Code å†…ç½®çš„ PR ä»£ç å®¡æŸ¥ Skillï¼Œç”¨äºå¯¹ GitHub Pull Request è¿›è¡Œç³»ç»ŸåŒ–ã€ä¸“ä¸šçš„ä»£ç å®¡æŸ¥ã€‚

**ä½¿ç”¨åœºæ™¯**:
- å®¡æŸ¥åŒäº‹æäº¤çš„ PR
- åœ¨åˆå¹¶å‰æ£€æŸ¥ä»£ç è´¨é‡
- å­¦ä¹ ä»£ç åº“çš„è§„èŒƒå’Œæ¨¡å¼

---

## è§¦å‘æ–¹å¼

### æ–œæ å‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# æ ¼å¼: /code-review <PRç¼–å·>
/code-review 123
```

### è‡ªç„¶è¯­è¨€è§¦å‘

ä»¥ä¸‹æè¿°éƒ½ä¼šè§¦å‘ code-review skillï¼š

```
"å¸®æˆ‘å®¡æŸ¥è¿™ä¸ª PR"
"Review PR #123"
"æ£€æŸ¥ä¸€ä¸‹è¿™æ¬¡æäº¤çš„ä»£ç è´¨é‡"
"code review a pull request"
```

---

## å·¥ä½œåŸç†

`code-review` skill é€šè¿‡ä»¥ä¸‹æ­¥éª¤å·¥ä½œï¼š

```
1. è¯»å– PR ä¿¡æ¯
   â””â”€ ä½¿ç”¨ gh pr view è·å– PR è¯¦æƒ…

2. è·å–å˜æ›´å†…å®¹
   â””â”€ ä½¿ç”¨ gh pr diff è·å– diff

3. åˆ†ææ–‡ä»¶å˜æ›´
   â”œâ”€ è¯»å–å˜æ›´çš„æ–‡ä»¶
   â”œâ”€ ç†è§£ä¸Šä¸‹æ–‡
   â””â”€ è¯†åˆ«é—®é¢˜ç‚¹

4. ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Š
   â”œâ”€ æ€»ç»“å˜æ›´
   â”œâ”€ åˆ—å‡ºé—®é¢˜ï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦åˆ†ç±»ï¼‰
   â””â”€ æä¾›å»ºè®®

5. å¯é€‰ï¼šæäº¤å®¡æŸ¥è¯„è®º
   â””â”€ é€šè¿‡ gh pr review æ·»åŠ è¯„è®º
```

---

## å®é™…æ¼”ç¤º

### åŸºç¡€ç”¨æ³•

```bash
# åœ¨å«æœ‰ GitHub ä»“åº“çš„é¡¹ç›®ç›®å½•ä¸­
$ claude

> /code-review 42
```

**Claude çš„å¤„ç†è¿‡ç¨‹**ï¼š

```
æ­£åœ¨è·å– PR #42 ä¿¡æ¯...
æ­£åœ¨åˆ†æ 5 ä¸ªå˜æ›´æ–‡ä»¶...
æ­£åœ¨ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Š...
```

**å®¡æŸ¥æŠ¥å‘Šç¤ºä¾‹**ï¼š

```markdown
## Code Review: Add User Authentication Feature (#42)

**æäº¤è€…**: @developer
**å˜æ›´**: 5 ä¸ªæ–‡ä»¶, +342 è¡Œ, -18 è¡Œ
**åˆ†æ”¯**: feature/user-auth â†’ main

---

### æ€»ç»“

å®ç°äº†åŸºäº JWT çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç™»å½•ã€æ³¨é”€å’Œä»¤ç‰Œåˆ·æ–°åŠŸèƒ½ã€‚
æ•´ä½“å®ç°æ€è·¯æ­£ç¡®ï¼Œä½†å­˜åœ¨å‡ ä¸ªå®‰å…¨æ–¹é¢éœ€è¦å…³æ³¨çš„é—®é¢˜ã€‚

---

### ğŸ”´ Critical Issues (å¿…é¡»ä¿®å¤)

#### 1. JWT Secret ç¡¬ç¼–ç åœ¨ä»£ç ä¸­

**æ–‡ä»¶**: `src/auth/jwt.service.ts:15`

```typescript
// âŒ å½“å‰ä»£ç 
private readonly secret = 'my-super-secret-key-12345';

// âœ… åº”è¯¥æ”¹ä¸º
private readonly secret = process.env.JWT_SECRET;
```

**é£é™©**: å¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä»»ä½•æœ‰ä»£ç è®¿é—®æƒé™çš„äººéƒ½èƒ½ä¼ªé€ ä»¤ç‰Œ

**ä¿®å¤**: å°†å¯†é’¥ç§»è‡³ç¯å¢ƒå˜é‡ï¼Œæ·»åŠ å¯åŠ¨æ£€æŸ¥

---

#### 2. ç™»å½•æ¥å£ç¼ºå°‘é€Ÿç‡é™åˆ¶

**æ–‡ä»¶**: `src/api/auth.controller.ts:28-45`

**é£é™©**: å¯èƒ½é­å—æš´åŠ›ç ´è§£æ”»å‡»

**ä¿®å¤**: æ·»åŠ  `express-rate-limit` ä¸­é—´ä»¶

```typescript
import rateLimit from 'express-rate-limit';

const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 5, // æœ€å¤š5æ¬¡å°è¯•
  message: 'ç™»å½•å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œè¯·15åˆ†é’Ÿåå†è¯•'
});

router.post('/login', loginLimiter, authController.login);
```

---

### ğŸŸ¡ Major Issues (å»ºè®®ä¿®å¤)

#### 3. Access Token æœ‰æ•ˆæœŸè¿‡é•¿

**æ–‡ä»¶**: `src/auth/jwt.service.ts:22`

```typescript
// âŒ å½“å‰: 30å¤©
expiresIn: '30d'

// âœ… å»ºè®®: 15-30åˆ†é’Ÿ
expiresIn: '15m'
```

**è¯´æ˜**: Access Token åº”è¯¥çŸ­æœŸæœ‰æ•ˆï¼Œåˆ©ç”¨ Refresh Token æœºåˆ¶å»¶ç»­ä¼šè¯

---

#### 4. å¯†ç å¼ºåº¦æœªéªŒè¯

**æ–‡ä»¶**: `src/auth/register.dto.ts`

**è¯´æ˜**: å½“å‰åªæ£€æŸ¥å¯†ç ä¸ä¸ºç©ºï¼Œåº”è¯¥éªŒè¯å¯†ç å¼ºåº¦

**ä¿®å¤**:
```typescript
@IsStrongPassword({
  minLength: 8,
  minLowercase: 1,
  minUppercase: 1,
  minNumbers: 1,
  minSymbols: 1
})
password: string;
```

---

### ğŸŸ¢ Minor Issues (å¯ä»¥æ”¹è¿›)

5. **é”™è¯¯æ¶ˆæ¯è¿‡äºè¯¦ç»†** (`src/auth/auth.service.ts:45`)
   - å½“å‰è¿”å›"é‚®ç®±ä¸å­˜åœ¨"æˆ–"å¯†ç é”™è¯¯"
   - å»ºè®®ç»Ÿä¸€è¿”å›"é‚®ç®±æˆ–å¯†ç ä¸æ­£ç¡®"ï¼ˆé˜²æ­¢ç”¨æˆ·æšä¸¾ï¼‰

6. **ç¼ºå°‘æµ‹è¯•è¦†ç›–** (`src/auth/*.spec.ts`)
   - å½“å‰æµ‹è¯•è¦†ç›–ç‡çº¦ 40%
   - å»ºè®®ä¸ºç™»å½•å¤±è´¥åœºæ™¯æ·»åŠ æµ‹è¯•

7. **æ³¨é‡Šä¸å®Œæ•´** (`src/auth/jwt.service.ts`)
   - `refreshToken` æ–¹æ³•ç¼ºå°‘ JSDoc æ³¨é‡Š

---

### âœ… åšå¾—å¥½çš„åœ°æ–¹

- âœ“ å¯†ç ä½¿ç”¨ bcrypt åŠ å¯†ï¼Œsalt rounds = 12ï¼Œå®‰å…¨æ€§å¥½
- âœ“ å®ç°äº† Refresh Token æœºåˆ¶ï¼Œé¿å…é¢‘ç¹ç™»å½•
- âœ“ ä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹ï¼Œä»£ç å¯è¯»æ€§å¥½
- âœ“ ä½¿ç”¨ DTO è¿›è¡Œè¾“å…¥éªŒè¯
- âœ“ ä»£ç ç»“æ„æ¸…æ™°ï¼Œç¬¦åˆ NestJS è§„èŒƒ

---

### æœ€ç»ˆå»ºè®®

**å®¡æŸ¥ç»“è®º**: ğŸŸ¡ **Approve with Changes**

åœ¨ä¿®å¤ä»¥ä¸‹é—®é¢˜åå¯ä»¥åˆå¹¶ï¼š
1. JWT Secret ç§»è‡³ç¯å¢ƒå˜é‡ï¼ˆ**å¿…é¡»**ï¼‰
2. æ·»åŠ ç™»å½•é€Ÿç‡é™åˆ¶ï¼ˆ**å¿…é¡»**ï¼‰
3. ç¼©çŸ­ Access Token æœ‰æ•ˆæœŸï¼ˆ**å¼ºçƒˆå»ºè®®**ï¼‰
4. åŠ å¼ºå¯†ç å¼ºåº¦éªŒè¯ï¼ˆ**å»ºè®®**ï¼‰

é¢„è®¡ä¿®å¤æ—¶é—´ï¼š2-3å°æ—¶
```

---

### å¸¦å‚æ•°çš„ç”¨æ³•

```bash
# ä¹Ÿå¯ä»¥ç›´æ¥æè¿° PR å†…å®¹è®© Claude å®¡æŸ¥
> å¸®æˆ‘ review è¿™ä¸ª PRï¼Œä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š
  1. å®‰å…¨æ¼æ´
  2. æ€§èƒ½é—®é¢˜
  3. æ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„ç¼–ç è§„èŒƒ

  PR é“¾æ¥: https://github.com/org/repo/pull/123
```

---

## å®¡æŸ¥ç»´åº¦è¯´æ˜

`code-review` skill ä¼šä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œå®¡æŸ¥ï¼š

### 1. å®‰å…¨æ€§ (Security)

```
æ£€æŸ¥é¡¹ç›®:
âœ“ æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼ˆå¯†é’¥ã€å¯†ç ã€Tokenï¼‰
âœ“ æ³¨å…¥æ¼æ´ï¼ˆSQLã€XSSã€å‘½ä»¤æ³¨å…¥ï¼‰
âœ“ è®¤è¯å’Œæˆæƒé—®é¢˜
âœ“ å¯†ç å­¦ä½¿ç”¨æ˜¯å¦æ­£ç¡®
âœ“ è¾“å…¥éªŒè¯æ˜¯å¦å……åˆ†
âœ“ ä¾èµ–åŒ…å®‰å…¨æ€§
```

### 2. æ­£ç¡®æ€§ (Correctness)

```
æ£€æŸ¥é¡¹ç›®:
âœ“ é€»è¾‘é”™è¯¯
âœ“ è¾¹ç•Œæ¡ä»¶å¤„ç†
âœ“ é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„
âœ“ å¹¶å‘å®‰å…¨æ€§
âœ“ å†…å­˜/èµ„æºç®¡ç†
```

### 3. æ€§èƒ½ (Performance)

```
æ£€æŸ¥é¡¹ç›®:
âœ“ ç®—æ³•å¤æ‚åº¦
âœ“ N+1 æŸ¥è¯¢é—®é¢˜
âœ“ ä¸å¿…è¦çš„é‡å¤è®¡ç®—
âœ“ èµ„æºé‡Šæ”¾
âœ“ ç¼“å­˜ä½¿ç”¨
```

### 4. å¯ç»´æŠ¤æ€§ (Maintainability)

```
æ£€æŸ¥é¡¹ç›®:
âœ“ ä»£ç å¯è¯»æ€§
âœ“ å‘½åè§„èŒƒ
âœ“ ä»£ç é‡å¤
âœ“ å¤æ‚åº¦
âœ“ æµ‹è¯•è¦†ç›–ç‡
```

### 5. è§„èŒƒç¬¦åˆæ€§ (Conventions)

```
æ£€æŸ¥é¡¹ç›®:
âœ“ é¡¹ç›®ç¼–ç è§„èŒƒ
âœ“ æäº¤ä¿¡æ¯æ ¼å¼
âœ“ æ–‡æ¡£æ›´æ–°
âœ“ API è®¾è®¡ä¸€è‡´æ€§
```

---

## ä¸ CI/CD é›†æˆ

### GitHub Actions ç¤ºä¾‹

```yaml
# .github/workflows/ai-review.yml
name: AI Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Claude Code
        run: npm install -g @anthropic-ai/claude-code

      - name: Run Code Review
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          claude --print "/code-review ${{ github.event.pull_request.number }}"
```

### ç»“åˆ Pre-commit Hook

```bash
# .git/hooks/pre-push
#!/bin/bash

# è·å–å°†è¦æ¨é€çš„ PR ç¼–å·ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
PR_NUM=$(gh pr list --head $(git branch --show-current) --json number -q '.[0].number')

if [ -n "$PR_NUM" ]; then
  echo "æ­£åœ¨è¿è¡Œ AI ä»£ç å®¡æŸ¥..."
  claude --print "/code-review $PR_NUM"
fi
```

---

## è¾“å‡ºæ ¼å¼å®šåˆ¶

ä½ å¯ä»¥åœ¨è°ƒç”¨æ—¶æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼š

```bash
# åªè¾“å‡ºå®‰å…¨é—®é¢˜
> å®¡æŸ¥ PR #123ï¼Œåªåˆ—å‡ºå®‰å…¨ç›¸å…³çš„é—®é¢˜

# è¾“å‡º JSON æ ¼å¼ï¼ˆä¾¿äºç¨‹åºå¤„ç†ï¼‰
> å®¡æŸ¥ PR #123ï¼Œä»¥ JSON æ ¼å¼è¾“å‡ºå®¡æŸ¥ç»“æœ

# åªçœ‹æ€»ç»“
> ç®€è¦å®¡æŸ¥ PR #123ï¼Œç»™æˆ‘ä¸€ä¸ªæ€»ä½“è¯„ä»·å°±å¥½
```

---

## å¸¸è§é—®é¢˜

### Q1: skill éœ€è¦ GitHub æƒé™å—ï¼Ÿ

**A**: æ˜¯çš„ï¼Œéœ€è¦ `gh` CLI å·²ç™»å½•å¹¶æœ‰ PR çš„è®¿é—®æƒé™ã€‚

```bash
# ç¡®è®¤ gh å·²ç™»å½•
gh auth status

# å¦‚æœæœªç™»å½•
gh auth login
```

### Q2: å¯¹ç§æœ‰ä»“åº“æœ‰æ•ˆå—ï¼Ÿ

**A**: åªè¦ `gh` æœ‰æƒé™è®¿é—®ï¼Œå°±æœ‰æ•ˆã€‚

### Q3: èƒ½å®¡æŸ¥è¶…å¤§ PRï¼ˆ>1000 è¡Œå˜æ›´ï¼‰å—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†æ•ˆæœä¼šä¸‹é™ã€‚å»ºè®®ï¼š
- å°†å¤§ PR æ‹†åˆ†ä¸ºå° PR
- æˆ–è€…æŒ‡å®š Claude é‡ç‚¹å…³æ³¨æŸäº›æ–‡ä»¶

```bash
> å®¡æŸ¥ PR #123ï¼Œåªåˆ†æ src/auth/ ç›®å½•ä¸‹çš„å˜æ›´
```

### Q4: èƒ½è‡ªåŠ¨æäº¤å®¡æŸ¥è¯„è®ºå—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½†éœ€è¦æ˜ç¡®è¦æ±‚ï¼š

```bash
> å®¡æŸ¥ PR #123ï¼Œå¹¶å°†æ¯ä¸ªé—®é¢˜ä½œä¸ºè¯„è®ºæäº¤åˆ°å¯¹åº”çš„ä»£ç è¡Œ
```

---

## æŠ€å·§ä¸æœ€ä½³å®è·µ

### 1. æä¾›é¡¹ç›®è§„èŒƒä¸Šä¸‹æ–‡

åœ¨ `CLAUDE.md` ä¸­æè¿°é¡¹ç›®è§„èŒƒï¼Œcode-review skill ä¼šè‡ªåŠ¨å‚è€ƒï¼š

```markdown
# CLAUDE.md

## ä»£ç å®¡æŸ¥è§„èŒƒ
- æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ JSDoc æ³¨é‡Š
- æµ‹è¯•è¦†ç›–ç‡ä¸ä½äº 80%
- ç¦æ­¢ä½¿ç”¨ `any` ç±»å‹
- æ‰€æœ‰ API å¿…é¡»æœ‰é€Ÿç‡é™åˆ¶
```

### 2. åŒºåˆ†å®¡æŸ¥ç±»å‹

```bash
# å®‰å…¨å®¡æŸ¥
> å¯¹ PR #123 è¿›è¡Œå®‰å…¨å®¡æŸ¥ï¼Œé‡ç‚¹æ˜¯è®¤è¯å’Œæˆæƒ

# æ€§èƒ½å®¡æŸ¥
> å¯¹ PR #123 è¿›è¡Œæ€§èƒ½å®¡æŸ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°æ®å¯†é›†å‹æ“ä½œ

# å¿«é€Ÿå®¡æŸ¥ï¼ˆåªçœ‹å…³é”®é—®é¢˜ï¼‰
> å¿«é€Ÿçœ‹ä¸€ä¸‹ PR #123ï¼Œæœ‰æ²¡æœ‰æ˜æ˜¾çš„é—®é¢˜
```

### 3. è¿­ä»£å®¡æŸ¥

```bash
# ç¬¬ä¸€è½®å®¡æŸ¥
> å®¡æŸ¥ PR #123

# å¼€å‘è€…ä¿®å¤åå†æ¬¡å®¡æŸ¥
> PR #123 å·²ç»ä¿®å¤äº†ä½ æåˆ°çš„å®‰å…¨é—®é¢˜ï¼Œè¯·å†æ¬¡å®¡æŸ¥
```

---

## ä¸ code-review:code-review çš„åŒºåˆ«

ç³»ç»Ÿä¸­å­˜åœ¨ä¸¤ä¸ªç›¸å…³çš„ skillï¼š

| ç‰¹æ€§ | `code-review` | `code-review:code-review` |
|------|---------------|--------------------------|
| ç”¨é€” | é€šç”¨ä»£ç å®¡æŸ¥ | å®Œå…¨é™å®šåç§°ï¼ˆFQNï¼‰è°ƒç”¨ |
| åŠŸèƒ½ | ç›¸åŒ | ç›¸åŒ |
| è°ƒç”¨æ–¹å¼ | `/code-review` | å®Œå…¨é™å®šåç§°è°ƒç”¨ |

ä¸¤è€…åŠŸèƒ½ç›¸åŒï¼Œ`code-review:code-review` æ˜¯ `code-review` çš„å®Œå…¨é™å®šåç§°ï¼ˆFully Qualified Nameï¼‰ï¼Œç”¨äºé¿å…åç§°å†²çªã€‚

---

## ç›¸å…³ Skills

- [webapp-testing](./webapp-testing.md) - æ­é…ä½¿ç”¨ï¼Œæµ‹è¯•ä¿®å¤åçš„ä»£ç 
- [frontend-design](./frontend-design.md) - å®¡æŸ¥å‰ç«¯ç›¸å…³ PR
- [skill-creator](./skill-creator.md) - åˆ›å»ºè‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™

---

**Skill ç‰ˆæœ¬**: å†…ç½®
**æœ€åæ›´æ–°**: 2026-02-10
